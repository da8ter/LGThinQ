{
  "capabilities": [
    {
      "ident": "POWER",
      "name": "Power",
      "type": "boolean",
      "presentation": { "kind": "switch", "captionOn": "An", "captionOff": "Aus" },
      "create": { "when": "profileHasAny", "keys": ["operation.power", "power", "is_on"] },
      "action": { "enableWhen": "never" },
      "read": { "sources": ["operation.power", "power", "is_on"], "map": { "ON": true, "1": true, "TRUE": true, "OFF": false, "0": false, "FALSE": false } }
    },

    {
      "ident": "WATER_TEMP_MODE",
      "name": "Wassertemp. Modus",
      "type": "integer",
      "presentation": { "kind": "buttons" },
      "create": { "when": "profileHasAny", "keys": ["water.temperature.mode", "temperature.mode", "waterTemp.mode"] },
      "action": { "enableWhen": "profileWriteableAny", "writeableKeys": ["water.temperature.mode", "temperature.mode", "waterTemp.mode"], "reassertOn": ["setup", "status"] },
      "read": { "sources": ["water.temperature.mode", "temperature.mode", "waterTemp.mode"], "map": { "COLD": 1, "AMBIENT": 2, "ROOM": 2, "HOT": 3 }, "mapCaseInsensitive": true },
      "write": { "enumMap": {
        "1": { "water": { "temperature": { "mode": "COLD" } } },
        "2": { "water": { "temperature": { "mode": "AMBIENT" } } },
        "3": { "water": { "temperature": { "mode": "HOT" } } }
      } }
    },

    {
      "ident": "DISPENSE_VOLUME_ML",
      "name": "Ausgabemenge (ml)",
      "type": "integer",
      "presentation": {
        "kind": "slider",
        "suffix": " ml",
        "range": { "min": 120, "max": 2000, "step": 10, "digits": 0 },
        "rangeFromProfile": {
          "min": [
            "dispense.volume.value.w.min",
            "water.dispense.volume.value.w.min",
            "volume.value.w.min",
            "amount.value.w.min"
          ],
          "max": [
            "dispense.volume.value.w.max",
            "water.dispense.volume.value.w.max",
            "volume.value.w.max",
            "amount.value.w.max"
          ],
          "step": [
            "dispense.volume.value.w.step",
            "water.dispense.volume.value.w.step",
            "volume.value.w.step",
            "amount.value.w.step"
          ]
        }
      },
      "create": { "when": "profileHasAny", "keys": ["dispense.volume", "water.dispense.volume", "volume", "amount"] },
      "action": { "enableWhen": "profileWriteableAny", "writeableKeys": ["dispense.volume.mode", "water.dispense.volume.mode", "volume.mode", "amount.mode"], "reassertOn": ["setup", "status"] },
      "read": { "sources": ["dispense.volume", "water.dispense.volume", "volume", "amount"] },
      "write": { "firstOf": [
        { "profileWriteableAny": ["dispense.volume.mode"],         "attribute": { "resource": "dispense", "property": "volume", "extras": { "unit": "ML" }, "clampFromProfile": true } },
        { "profileWriteableAny": ["water.dispense.volume.mode"],   "template": { "water": { "dispense": { "volume": "@int", "unit": "ML" } } } }
      ] }
    },

    {
      "ident": "DISPENSE",
      "name": "Ausgabe",
      "type": "integer",
      "presentation": { "kind": "buttons", "options": [
        { "value": 1, "caption": "Start" },
        { "value": 0, "caption": "Stop" }
      ] },
      "create": { "when": "profileHasAny", "keys": ["dispense.operation", "water.dispense.operation"] },
      "action": { "enableWhen": "profileWriteableAny", "writeableKeys": ["dispense.operation.mode", "water.dispense.operation.mode"], "reassertOn": ["setup", "status"] },
      "read": { "sources": ["dispense.operation", "water.dispense.operation"], "map": { "START": 1, "STOP": 0 }, "mapCaseInsensitive": true },
      "write": { "enumMap": {
        "1": { "dispense.operation": "START" },
        "0": { "dispense.operation": "STOP" }
      } }
    },

    {
      "ident": "CHILD_LOCK",
      "name": "Kindersicherung",
      "type": "boolean",
      "presentation": { "kind": "switch", "captionOn": "An", "captionOff": "Aus" },
      "create": { "when": "profileHasAny", "keys": ["childLock", "childLock.enabled", "lock.child", "hotWaterLock.enabled"] },
      "action": { "enableWhen": "profileWriteableAny", "writeableKeys": ["childLock.mode", "childLock.enabled.mode", "hotWaterLock.enabled.mode"], "reassertOn": ["setup", "status"] },
      "read": { "sources": ["childLock", "childLock.enabled", "lock.child", "hotWaterLock.enabled"] },
      "write": { "firstOf": [
        { "profileWriteableAny": ["childLock.enabled.mode"],   "attribute": { "resource": "childLock",   "property": "enabled", "valueTemplate": "@bool" } },
        { "profileWriteableAny": ["hotWaterLock.enabled.mode"], "attribute": { "resource": "hotWaterLock", "property": "enabled", "valueTemplate": "@bool" } }
      ] }
    },

    {
      "ident": "FILTER_REMAIN_PERCENT",
      "name": "Filter verbleibend",
      "type": "integer",
      "presentation": { "kind": "value", "suffix": " %" },
      "create": { "when": "profileHasAny", "keys": ["filter.remainPercent", "filterRemainPercent", "filter.remain"] },
      "action": { "enableWhen": "never" },
      "read": { "sources": ["filter.remainPercent", "filterRemainPercent", "filter.remain"] }
    },

    {
      "ident": "TANK_LEVEL_PERCENT",
      "name": "Tankstand",
      "type": "integer",
      "presentation": { "kind": "value", "suffix": " %" },
      "create": { "when": "statusHasAny", "keys": ["tank.remainPercent", "waterTank.remainPercent", "tank.levelPercent"] },
      "action": { "enableWhen": "never" },
      "read": { "sources": ["tank.remainPercent", "waterTank.remainPercent", "tank.levelPercent"] }
    },

    {
      "ident": "TDS",
      "name": "TDS",
      "type": "integer",
      "presentation": { "kind": "value", "suffix": " ppm" },
      "create": { "when": "statusHasAny", "keys": ["water.quality.tds", "tds", "waterTds"] },
      "action": { "enableWhen": "never" },
      "read": { "sources": ["water.quality.tds", "tds", "waterTds"] }
    },

    {
      "ident": "WATER_TEMP_CUR",
      "name": "Wassertemperatur",
      "type": "float",
      "presentation": { "kind": "value", "suffix": " Â°C", "usageType": 1 },
      "create": { "when": "statusHasAny", "keys": ["water.temperature.current", "currentTemperature"] },
      "action": { "enableWhen": "never" },
      "read": { "sources": ["water.temperature.current", "currentTemperature"] }
    },

    {
      "ident": "STERILIZE",
      "name": "Sterilisieren",
      "type": "boolean",
      "presentation": { "kind": "switch", "captionOn": "An", "captionOff": "Aus" },
      "create": { "when": "profileHasAny", "keys": ["sterilize", "uvSterilize", "sterilization"] },
      "action": { "enableWhen": "profileWriteableAny", "writeableKeys": ["sterilize.mode", "uvSterilize.mode", "sterilization.mode"], "reassertOn": ["setup", "status"] },
      "read": { "sources": ["sterilize", "uvSterilize", "sterilization"], "string_true": ["ON", "TRUE", "1"], "string_false": ["OFF", "FALSE", "0"] },
      "write": { "template": { "sterilize": "@onoff" } }
    }
  ]
}
