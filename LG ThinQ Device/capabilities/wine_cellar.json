{
  "capabilities": [
    {
      "ident": "POWER",
      "name": "Power",
      "type": "boolean",
      "presentation": { "kind": "switch", "captionOn": "An", "captionOff": "Aus" },
      "create": { "when": "profileHasAny", "keys": ["operation.power", "power", "is_on"] },
      "action": { "enableWhen": "never" },
      "read": { "sources": ["operation.power", "power", "is_on"], "map": { "ON": true, "1": true, "TRUE": true, "OFF": false, "0": false, "FALSE": false } }
    },

    {
      "ident": "WINE_LIGHT",
      "name": "Licht",
      "type": "boolean",
      "presentation": { "kind": "switch", "captionOn": "An", "captionOff": "Aus" },
      "create": { "when": "profileHasAny", "keys": ["display.light", "light", "cabinet.light"] },
      "action": { "enableWhen": "profileWriteableAny", "writeableKeys": ["display.light.mode", "light.mode", "cabinet.light.mode"], "reassertOn": ["setup", "status"] },
      "read": { "sources": ["display.light", "light", "cabinet.light"], "string_true": ["ON", "TRUE", "1"], "string_false": ["OFF", "FALSE", "0"] },
      "write": { "template": { "display": { "light": "@onoff" } } }
    },

    {
      "ident": "UPPER_SET_TEMP",
      "name": "Oberer Soll",
      "type": "float",
      "presentation": {
        "kind": "slider",
        "suffix": " °C",
        "usageType": 0,
        "gradientType": 1,
        "range": { "min": 4, "max": 18, "step": 1 },
        "rangeFromProfile": {
          "min": [
            "upperTemperature.target.value.w.min",
            "temperature.upper.target.value.w.min",
            "zones.0.temperature.target.value.w.min"
          ],
          "max": [
            "upperTemperature.target.value.w.max",
            "temperature.upper.target.value.w.max",
            "zones.0.temperature.target.value.w.max"
          ],
          "step": [
            "upperTemperature.target.value.w.step",
            "temperature.upper.target.value.w.step",
            "zones.0.temperature.target.value.w.step"
          ]
        }
      },
      "create": { "when": "profileHasAny", "keys": ["upperTemperature.target", "temperature.upper.target", "zones.0.temperature.target"] },
      "action": { "enableWhen": "profileWriteableAny", "writeableKeys": ["upperTemperature.target.mode", "temperature.upper.target.mode", "zones.0.temperature.target.mode"], "reassertOn": ["setup", "status"] },
      "read": { "sources": ["upperTemperature.target", "temperature.upper.target", "zones.0.temperature.target"] },
      "write": {
        "clamp": { "min": 4, "max": 18 },
        "firstOf": [
          { "profileWriteableAny": ["temperatureInUnits.0.targetTemperatureC.mode", "temperatureInUnits.1.targetTemperatureC.mode"],
            "attribute": { "resource": "temperatureInUnits", "property": "targetTemperatureC", "extras": { "locationName": "WINE_UPPER" }, "clampFromProfile": true } },
          { "profileWriteableAny": ["upperTemperature.target.mode"],
            "template": { "upperTemperature": { "target": "@float", "unit": "C" } } },
          { "profileWriteableAny": ["temperature.upper.target.mode"],
            "template": { "temperature": { "upper": { "target": "@float", "unit": "C" } } } },
          { "profileWriteableAny": ["zones.0.temperature.target.mode"],
            "template": { "zones": { "0": { "temperature": { "target": "@float", "unit": "C" } } } } }
        ]
      }
    },
    {
      "ident": "UPPER_CUR_TEMP",
      "name": "Oberer Ist",
      "type": "float",
      "presentation": { "kind": "value", "suffix": " °C", "usageType": 1 },
      "create": { "when": "statusHasAny", "keys": ["upperTemperature.current", "temperature.upper.current", "zones.0.temperature.current", "upperCurrentTemperature"] },
      "action": { "enableWhen": "never" },
      "read": { "sources": ["upperTemperature.current", "temperature.upper.current", "zones.0.temperature.current", "upperCurrentTemperature"] }
    },

    {
      "ident": "LOWER_SET_TEMP",
      "name": "Unterer Soll",
      "type": "float",
      "presentation": {
        "kind": "slider",
        "suffix": " °C",
        "usageType": 0,
        "gradientType": 1,
        "range": { "min": 4, "max": 18, "step": 1 },
        "rangeFromProfile": {
          "min": [
            "lowerTemperature.target.value.w.min",
            "temperature.lower.target.value.w.min",
            "zones.1.temperature.target.value.w.min"
          ],
          "max": [
            "lowerTemperature.target.value.w.max",
            "temperature.lower.target.value.w.max",
            "zones.1.temperature.target.value.w.max"
          ],
          "step": [
            "lowerTemperature.target.value.w.step",
            "temperature.lower.target.value.w.step",
            "zones.1.temperature.target.value.w.step"
          ]
        }
      },
      "create": { "when": "profileHasAny", "keys": ["lowerTemperature.target", "temperature.lower.target", "zones.1.temperature.target"] },
      "action": { "enableWhen": "profileWriteableAny", "writeableKeys": ["lowerTemperature.target.mode", "temperature.lower.target.mode", "zones.1.temperature.target.mode"], "reassertOn": ["setup", "status"] },
      "read": { "sources": ["lowerTemperature.target", "temperature.lower.target", "zones.1.temperature.target"] },
      "write": {
        "clamp": { "min": 4, "max": 18 },
        "firstOf": [
          { "profileWriteableAny": ["temperatureInUnits.0.targetTemperatureC.mode", "temperatureInUnits.1.targetTemperatureC.mode"],
            "attribute": { "resource": "temperatureInUnits", "property": "targetTemperatureC", "extras": { "locationName": "WINE_LOWER" }, "clampFromProfile": true } },
          { "profileWriteableAny": ["lowerTemperature.target.mode"],
            "template": { "lowerTemperature": { "target": "@float", "unit": "C" } } },
          { "profileWriteableAny": ["temperature.lower.target.mode"],
            "template": { "temperature": { "lower": { "target": "@float", "unit": "C" } } } },
          { "profileWriteableAny": ["zones.1.temperature.target.mode"],
            "template": { "zones": { "1": { "temperature": { "target": "@float", "unit": "C" } } } } }
        ]
      }
    },
    {
      "ident": "LOWER_CUR_TEMP",
      "name": "Unterer Ist",
      "type": "float",
      "presentation": { "kind": "value", "suffix": " °C", "usageType": 1 },
      "create": { "when": "statusHasAny", "keys": ["lowerTemperature.current", "temperature.lower.current", "zones.1.temperature.current", "lowerCurrentTemperature"] },
      "action": { "enableWhen": "never" },
      "read": { "sources": ["lowerTemperature.current", "temperature.lower.current", "zones.1.temperature.current", "lowerCurrentTemperature"] }
    },

    {
      "ident": "DOOR_OPEN",
      "name": "Tür offen",
      "type": "boolean",
      "presentation": { "kind": "switch", "captionOn": "Offen", "captionOff": "Zu" },
      "create": { "when": "statusHasAny", "keys": ["doorOpen", "door", "door.status"] },
      "action": { "enableWhen": "never" },
      "read": { "sources": ["doorOpen", "door", "door.status"], "string_true": ["OPEN", "ON", "TRUE", "1"], "string_false": ["CLOSE", "CLOSED", "OFF", "FALSE", "0"] }
    }
  ]
}
